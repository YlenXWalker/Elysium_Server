//===== rAthena Script =======================================
//= Eden Group Quest - Quests NPCs
//===== Description: =========================================
//= Eden Group Headquarter NPCs.
//===== Changelogs: ==========================================
//= 1.0 First Version. [L0ne_W0lf]
//= 1.1 Removed unencoded comments (Korean -> Gibberish)
//=     Readded the GM helper NPC, commented out.
//= 1.2 Some little optimization here and there. [Masao]
//= 1.3 Added Instructor Ur and the new Quests which come
//=     alongside him. Special thanks to Chilly for the base. [Masao]
//= 1.4 Partial cleaning and bug fixing. [Euphy]
//= 1.4a Added 'npcskill' command. [Euphy]
//= 1.4b Added 'disable_items' command. [Euphy]
//= 1.5 Added GM management function. [Euphy]
//= 1.6 Kagerou/Oboro support (Class -> BaseClass) [Euphy]
//= 2.0 Updated Instructor Ur's quests. [Capuche]
//= 2.1 Updated Blacksmith Thorn and Weapons Expert NPC. [Capuche]
//= 2.2 Added support to Para_Team_Mark_ in Eden Group. [Ragno]
//= 2.3 Added use of F_HasEdenGroupMark function. [Ragno]
//= 2.4 Adds quest management, progression, and warp points to 
//=		support multi-step training quests for players.. [Louis T Steinhil]
//============================================================
anthell01,29,264,5	script	Eden Member Cloud#para06	899,{  
	// Check Eden Group membership and quest state  
	if (para_suv01 < 17) {  
		if (callfunc("F_HasEdenGroupMark")) {  
			mes "[Cloud]";  
			mes "Oops.";  
			mes "You are a member of my group.";  
			mes "Why did you come here, are you looking for danger?";  
			next;  
			mes "[Cloud]";  
			mes "One of the strongest boss monsters is in here.";  
			mes "Be careful when exploring here.";  
			close;  
		}  
		mes "[Cloud]";  
		mes "What are you looking at?";  
		mes "We are not related to each other, are we...";  
		next;  
		switch(select("Quest Management:Just passing by:Leave")) {  
			case 1: callsub S_QuestManagement; break;  
			case 2:  
				mes "[Cloud]";  
				mes "Take care in the desert heat!";  
				break;  
			case 3: break;  
		}  
		close;  
	}  
	  
	// Quest state management  
	switch(para_suv01) {  
	case 17:  
		callsub S_InitialQuest;  
		break;  
		  
	case 18:  
		callsub S_PierreHunt;  
		break;  
		  
	case 19:  
		callsub S_AndreHunt;  
		break;  
		  
	case 20:  
		callsub S_VitataHunt;  
		break;  
		  
	default:  
		if (para_suv01 >= 21) {  
			callsub S_QuestComplete;  
		} else {  
			callsub S_DefaultDialog;  
		}  
		break;  
	}  
	end;  
  
// Initial quest introduction  
S_InitialQuest:  
	mes "[Cloud]";  
	mes "Hello?";  
	mes "Why did you come here, looking for danger?";  
	next;  
	switch (select("Conquer Ant Hell:Just wanted to meet you:Where am I?:Quest Help")) {  
	case 1:  
		mes "[Cloud]";  
		mes "Uh. Conquer Ant Hell? Did you say that?";  
		mes "You are a trainee.";  
		mes "You have come to the right place.";  
		next;  
		mes "[Cloud]";  
		mes "At first I will explain about Ant Hell.";  
		mes "Ants dug a cave in the sand and it is linked to the surface. That's Ant Hell.";  
		next;  
		mes "[Cloud]";  
		mes "Sand flowed into the hole gradually.";  
		mes "If anyone steps on the hole they will fall into the cave through the hole in the sand...";  
		next;  
		mes "[Cloud]";  
		mes "It's hard to survive from there.";  
		mes "To us it seems like a normal happening so it isn't a matter of survival like to normal people.";  
		next;  
		mes "[Cloud]";  
		mes "Many kinds of ants have come to live here.";  
		mes "There is a boss monster named Maya so you should be more cautious.";  
		next;  
		mes "[Cloud]";  
		mes "Ok let's try to hunt the weakest ant first.";  
		mes "Pierre is the name of the weakest ant.";  
		mes "They are just down here.";  
		next;  
		mes "[Cloud]";  
		mes "In the case of ants, they assist each other when attacked.";  
		mes "Be careful and kill 15 Pierre ants.";  
		para_suv01 = 18;  
		changequest 7142,7143;  
		close;  
	case 2:  
		mes "[Cloud]";  
		mes "......";  
		mes "Haha... are you joking?";  
		mes "You are exhausted from the extremely hot weather in the desert.";  
		next;  
		mes "[Cloud]";  
		mes "I am a busy man.";  
		mes "One of the trainees was planning to visit me but that person still hasn't showed yet. I am getting nervous.";  
		close;  
	case 3:  
		mes "[Cloud]";  
		mes "Where you are?";  
		mes "You are in Ant Hell southwest of Morocc.";  
		mes "Morocc is the closest city, northeast of here.";  
		close;  
	case 4:  
		callsub S_QuestManagement;  
		break;  
	}  
	return;  
  
// Pierre hunting phase  
S_PierreHunt:  
	if (checkquest(7143,HUNTING) == 2) {  
		mes "[Cloud]";  
		mes "Hey, what was it?";  
		mes "Let me reward you.";  
		mes "Base Experience: "+ F_Insertcomma(.base_exp[0]) +".";  
		mes "Job Experience: "+ F_Insertcomma(.job_exp[0]) +".";  
		mes "Item: "+ F_Insertcomma(.item_amount[0]) +"x "+ mesitemicon(.item_reward[0]) +".";  
		next;  
		mes "[Cloud]";
		// Claim reward  
		getexp .base_exp[0], .job_exp[0];  
		getitem .item_reward[0], .item_amount[0];
		mes "Maybe you saw an Andre when you were hunting Pierre.";  
		mes "Well, now let's hunt Andre as well.";  
		mes "Ahah the way you're looking at me, 'why didn't I ask you to do this all at once' right?";  
		next;  
		mes "[Cloud]";  
		mes "Ain't it more fun this way?";  
		mes "Hey, now your next target is 15 Andre!";  
		mes "You are strong so it will be fine!";  
		next;
		mes "[Cloud]";  
		mes "If you can't find Andre go deeper into the cave.";  
		mes "Ah, and be careful of Maya.";  
		para_suv01 = 19;  
		changequest 7143,7144;  
		close;  
	}  
	  
	mes "[Cloud]";  
	mes "What do you think of Ant Hell?";  
	mes "Can you stay longer?";  
	mes "Ok, I will recover your strength so, keep going.";  
	next;  
	switch(select("Get healed:Quest Management:Continue hunting")) {  
		case 1: callsub S_HealPlayer; break;  
		case 2: callsub S_QuestManagement; break;  
		case 3: break;  
	}  
	return;  
  
// Andre hunting phase  
S_AndreHunt:  
	if (checkquest(7144,HUNTING) == 2) {  
		mes "[Cloud]";  
		mes "Great. You seem to have killed all of the Andre.";  
		mes "Let me reward you.";  
		mes "Base Experience: "+ F_Insertcomma(.base_exp[1]) +".";  
		mes "Job Experience: "+ F_Insertcomma(.job_exp[1]) +".";  
		mes "Item: "+ F_Insertcomma(.item_amount[1]) +"x "+ mesitemicon(.item_reward[1]) +".";  
		next;  
		mes "[Cloud]";
		// Claim reward  
		getexp .base_exp[1], .job_exp[1];  
		getitem .item_reward[1], .item_amount[1];
		mes "How do you think about fighting ants?";  
		mes "Was it good?";  
		next;  
		mes "[Cloud]";  
		mes "Hey, cheer up.";  
		mes "To conquer Ant Hell you have one step left.";  
		mes "You might have guessed your next target already.";  
		next;  
		mes "[Cloud]";  
		mes "Vitata!";  
		mes "How can I say... He seems like honey.";  
		mes "Pierre is a worker. Andre is a guardian and so... Vitata is like a mother.";    
		mes "[Cloud]";  
		mes "They are really kind to kids and women but don't show any pity to ants.";  
		mes "Hunt the Vitata who takes care of the ant eggs.";  
		next;  
		mes "[Cloud]";  
		mes "If somebody falls into Ant Hell it might be a bit safer than before.";  
		mes "Now it's the last step so cheer up and let's kill 10 Vitata.";  
		next;  
		mes "[Cloud]";  
		mes "If you feel you're in too much danger. Just come back.";  
		mes "I will heal you.";  
		para_suv01 = 20;  
		changequest 7144,7145;  
		close;  
	}  
	  
	mes "[Cloud]";  
	mes "See, to cheer you up I will heal you until you finish the training.";  
	mes "Chin up and cheer up.";  
	next;  
	switch(select("Get healed:Quest Management:Continue hunting")) {  
		case 1: callsub S_HealPlayer; break;  
		case 2: callsub S_QuestManagement; break;  
		case 3: break;  
	}  
	return;  
  
// Vitata hunting phase  
S_VitataHunt:  
	if (checkquest(7145,HUNTING) == 2) {  
		mes "[Cloud]";  
		mes "Oh... it might have been an annoying fight.";  
		mes "You finished so fast.";  
		next;  
		mes "[Cloud]";  
		mes "Good job. Go back to the headquarters and report.";  
		mes "You've completed the training quickly.";  
		mes "Let me reward you.";  
		mes "Base Experience: "+ F_Insertcomma(.base_exp[2]) +".";  
		mes "Job Experience: "+ F_Insertcomma(.job_exp[2]) +".";  
		mes "Item: "+ F_Insertcomma(.item_amount[2]) +"x "+ mesitemicon(.item_reward[2]) +".";  
		next;  
		// Claim reward  
		getexp .base_exp[2], .job_exp[2];  
		getitem .item_reward[2], .item_amount[2];  
		mes "[Cloud]";  
		mes "You will get good news.";  
		mes "You did a really good job even under the hot weather.";  
		para_suv01 = 21;  
		changequest 7145,7146;  
		close;  
	}  
	  
	mes "[Cloud]";  
	mes "See, to cheer you up I will heal you until you finish the training.";  
	mes "Chin up and cheer up.";  
	next;  
	mes "[Cloud]";  
	mes "Just Vitata, isn't that an easy opponent?";  
	mes "If you see Maya just run away.";  
	next;  
	switch(select("Get healed:Quest Management:Continue hunting")) {  
		case 1: callsub S_HealPlayer; break;  
		case 2: callsub S_QuestManagement; break;  
		case 3: break;  
	}  
	return;  
  
// Quest completion state  
S_QuestComplete:  
	mes "[Cloud]";  
	mes "It's enough to say that you've conquered Ant Hell.";  
	mes "Aren't you getting used to it here?";  
	next;  
	mes "[Cloud]";  
	mes "Go back to the headquarters and report that you completed the mission, hurry up";  
	mes "you will receive good news.";  
	mes "You will receive the Eden Group uniform as well.";  
	next;  
	switch(select("Quest Management:Just chatting:Leave")) {  
		case 1: callsub S_QuestManagement; break;  
		case 2:  
			mes "[Cloud]";  
			mes "Keep up the excellent work with Eden Group!";  
			break;  
		case 3: break;  
	}  
	close;  
  
// Default dialog  
S_DefaultDialog:  
	mes "[Cloud]";  
	mes "I am really proud of the Eden Group.";  
	mes "Does the uniform look good on me?";  
	mes "Haha...";  
	next;  
	switch(select("Quest Management:Just chatting:Leave")) {  
		case 1: callsub S_QuestManagement; break;  
		case 2:  
			mes "[Cloud]";  
			mes "Keep up the excellent work with Eden Group!";  
			break;  
		case 3: break;  
	}  
	close;  
  
// Helper function for healing  
S_HealPlayer:  
	mes "-Cloud's desert survival skills restore your vitality.-";  
	npcskill "AL_HEAL",11,99,60;  
	percentheal 100,100;  
	return;  
  
// Quest Management Functions  
S_QuestManagement:  
	mes "[Cloud]";  
	mes "What do you need help with regarding your Ant Hell training?";  
	next;  
	switch(select("View Current Quest:Abandon Quest:Quest Status:Cancel")) {  
		case 1: callsub S_ViewCurrentQuest; break;  
		case 2: callsub S_AbandonQuest; break;  
		case 3: callsub S_QuestStatus; break;  
		case 4: mes "Come back if you need help surviving the desert!"; break;  
	}  
	return;  
  
S_ViewCurrentQuest:  
	mes "[Cloud]";  
	mes "Your current Ant Hell training progress:";  
	mes " ";  
	  
	switch(para_suv01) {  
		case 17:  
			mes "^0000FFAnt Hell Introduction^000000";  
			mes "  Status: Accept the Ant Hell training mission";  
			break;  
		case 18:  
			mes "^00FF00Pierre Hunt^000000 - In Progress";  
			mes "  Status: Hunt 15 Pierre ants in Ant Hell";  
			break;  
		case 19:  
			mes "^00FF00Andre Hunt^000000 - In Progress";  
			mes "  Status: Hunt 15 Andre ants in Ant Hell";  
			break;  
		case 20:  
			mes "^00FF00Vitata Hunt^000000 - In Progress";  
			mes "  Status: Hunt 10 Vitata ants (Final step!)";  
			break;  
		case 21:  
			mes "^0000FFAnt Hell Training Complete^000000";  
			mes "  Status: Return to Boya at Eden Group HQ";  
			break;  
		default:  
			mes "^FF0000No active Ant Hell training quest.^000000";  
			mes "^FF0000You might need to talk to Instructor Boya first.^000000";  
			break;  
	}  
	return;  
  
S_AbandonQuest:  
	if (para_suv01 < 17 || para_suv01 > 20) {  
		mes "[Cloud]";  
		mes "You don't have any active Ant Hell training to abandon.";  
		return;  
	}  
	  
	mes "[Cloud]";  
	mes "^FF0000Warning:^000000 Abandoning will only clear your current hunting progress!";  
	mes "Are you sure you want to give up? The ants need to be controlled!";  
	next;  
	  
	if (select("Yes, abandon current hunt:No, continue training") == 2) {  
		mes "[Cloud]";  
		mes "Good choice! The ants won't defeat themselves!";  
		return;  
	}  
	  
	// Only erase current hunting quest  
	switch(para_suv01) {  
		case 18:  
			if (checkquest(7143) >= 0) erasequest 7143;  
			para_suv01 = 17;  // Back to introduction  
			break;  
		case 19:  
			if (checkquest(7144) >= 0) erasequest 7144;  
			para_suv01 = 18;  // Back to Pierre hunt  
			break;  
		case 20:  
			if (checkquest(7145) >= 0) erasequest 7145;  
			para_suv01 = 19;  // Back to Andre hunt  
			break;  
	}  
	  
	mes "[Cloud]";  
	mes "Current hunt abandoned. You can restart this step anytime.";  
	return;  
  
S_QuestStatus:  
	mes "[Cloud]";  
	mes "Let me check your hunting progress in the desert heat...";  
	mes " ";  
	  
	switch(para_suv01) {  
		case 18:  
			.@progress = checkquest(7143,HUNTING);  
			if (.@progress == 2) {  
				mes "^00FF00Pierre Hunt: COMPLETE!^000000";  
				mes "Come talk to me to proceed to the next step.";  
			} else {  
				mes "^FFFFFFPierre Hunt: In Progress^000000";  
				mes "Keep hunting those worker ants in Ant Hell.";  
			}  
			break;  
		case 19:  
			.@progress = checkquest(7144,HUNTING);  
			if (.@progress == 2) {  
				mes "^00FF00Andre Hunt: COMPLETE!^000000";  
				mes "Come talk to me to proceed to the next step.";  
			} else {  
				mes "^FFFFFFAndre Hunt: In Progress^000000";  
				mes "Keep hunting those guardian ants deeper in the cave.";  
			}  
			break;  
		case 20:  
			.@progress = checkquest(7145,HUNTING);  
			if (.@progress == 2) {  
				mes "^00FF00Vitata Hunt: COMPLETE!^000000";  
				mes "Come talk to me to finish your Ant Hell training!";  
			} else {  
				mes "^FFFFFFVitata Hunt: In Progress^000000";  
				mes "Just 10 more Vitata to secure Ant Hell!";  
			}  
			break;  
		default:  
			mes "^FF0000No active hunting quests to check.^000000";  
			break;  
	}  
	return;  
  
OnInit:  
	setunitdata(getnpcid(0), UNPC_GROUP_ID, 6);
	//setunittitle( getnpcid(0), "Cloud" );
	setarray .base_exp[0], 3200, 5400, 6000;    
	setarray .job_exp[0], 3200, 5400, 6000;  
	setarray .item_reward[0], 25223, 25223, 25223;    
	setarray .item_amount[0], 1, 1, 1;  
	end;  
}