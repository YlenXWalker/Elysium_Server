//===== rAthena Script =======================================
//= Eden Group Quest - Quests NPCs
//===== Description: =========================================
//= Eden Group Headquarter NPCs.
//===== Changelogs: ==========================================
//= 1.0 First Version. [L0ne_W0lf]
//= 1.1 Removed unencoded comments (Korean -> Gibberish)
//=     Readded the GM helper NPC, commented out.
//= 1.2 Some little optimization here and there. [Masao]
//= 1.3 Added Instructor Ur and the new Quests which come
//=     alongside him. Special thanks to Chilly for the base. [Masao]
//= 1.4 Partial cleaning and bug fixing. [Euphy]
//= 1.4a Added 'npcskill' command. [Euphy]
//= 1.4b Added 'disable_items' command. [Euphy]
//= 1.5 Added GM management function. [Euphy]
//= 1.6 Kagerou/Oboro support (Class -> BaseClass) [Euphy]
//= 2.0 Updated Instructor Ur's quests. [Capuche]
//= 2.1 Updated Blacksmith Thorn and Weapons Expert NPC. [Capuche]
//= 2.2 Added support to Para_Team_Mark_ in Eden Group. [Ragno]
//= 2.3 Added use of F_HasEdenGroupMark function. [Ragno]
//= 2.4 Adds quest management, progression, and warp points to 
//=		support multi-step training quests for players.. [Louis T Steinhil]
//============================================================
iz_dun04,43,46,3	script	Eden Member Callandiva	4_F_CRU,{  
	// Check Eden Group membership and quest state  
	if (para_suv01 < 33) {  
		if (callfunc("F_HasEdenGroupMark")) {  
			mes "[Callandiva]";  
			mes "How did you get so deep in this ocean city?";  
			mes "Ah, that symbol is of our group.";  
			mes "You're a trainee for sure.";  
			next;  
			mes "[Callandiva]";  
			mes "What? You aren't?";  
			mes "I... see... I see...";  
			mes "Ok... keep going.";  
			close;  
		}  
		mes "[Callandiva]";  
		mes "Mysteriously although we're under the sea you can still breathe here.";  
		mes "Do you know why?";  
		next;  
		mes "[Callandiva]";  
		mes "Let's see due to the moisture my skin is so soft.";  
		mes "My fingers and toes are not attached to each other amazing.";  
		next;  
		mes "[Callandiva]";  
		mes "I was really shocked and scared when the Eden Group dispatched me here.";  
		mes "Now I love this environment so much.";  
		mes "It's really calm...";  
		next;  
		switch(select("Quest Management:Just exploring:Leave")) {  
			case 1: callsub S_QuestManagement; break;  
			case 2:  
				mes "[Callandiva]";  
				mes "Take care in the deep ocean waters!";  
				break;  
			case 3: break;  
		}  
		close;  
	}  
	  
	// Quest state management  
	switch(para_suv01) {  
	case 33:  
		callsub S_InitialQuest;  
		break;  
		  
	case 34:  
		callsub S_MermanHunt;  
		break;  
		  
	case 35:  
		callsub S_StroufHunt;  
		break;  
		  
	default:  
		if (para_suv01 >= 36) {  
			callsub S_QuestComplete;  
		} else {  
			callsub S_DefaultDialog;  
		}  
		break;  
	}  
	end;  
  
// Initial quest introduction  
S_InitialQuest:  
	mes "[Callandiva]";  
	mes "How did you get so deep in this ocean city?";  
	mes "Ah, that symbol is of our group.";  
	mes "You're a trainee for sure.";  
	next;  
	mes "[Callandiva]";  
	mes "Good to see you!";  
	mes "Alright, look down.";  
	mes "Ancient buildings are sleeping under the water. They were actually built under the sea.";  
	next;  
	mes "[Callandiva]";  
	mes "As you know we don't have any trouble living here.";  
	mes "But if you see over there... yes right there.";  
	next;  
	mes "[Callandiva]";  
	mes "Can you see a humanoid fish with a very threatening spear?";  
	mes "He is called a Merman and is a really professional warrior.";  
	next;  
	switch(select("Accept the mission:Quest Help:Not ready yet")) {  
		case 1:  
			mes "[Callandiva]";  
			mes "Okay, go and hunt 15 Merman.";  
			mes "That will be your 1st training mission here.";  
			para_suv01 = 34;  
			changequest 7156,7157;  
			close;  
		case 2:  
			callsub S_QuestManagement;  
			break;  
		case 3:  
			mes "[Callandiva]";  
			mes "Come back when you're ready for the ocean city challenge.";  
			close;  
	}  
	return;  
  
// Merman hunting phase  
S_MermanHunt:  
	if (checkquest(7157,HUNTING) == 2) {  
		mes "[Callandiva]";  
		mes "Oh, you came back~!";  
		mes "Let me reward you.";  
		mes "Base Experience: "+ F_Insertcomma(.base_exp[0]) +".";  
		mes "Job Experience: "+ F_Insertcomma(.job_exp[0]) +".";  
		mes "Item: "+ F_Insertcomma(.item_amount[0]) +"x "+ mesitemicon(.item_reward[0]) +".";  
		next;  
		// Claim reward  
		getexp .base_exp[0], .job_exp[0];  
		getitem .item_reward[0], .item_amount[0];
		mes "[Callandiva]";
		mes "What did you think of those threatening Mermans?";  
		mes "Actually, I thought that you would chicken out~";  
		next;  
		mes "[Callandiva]";  
		mes "Good your next opponent will be...~";  
		mes "Yes, this one...";  
		mes "The monster that is holding a trident.";  
		next;  
		mes "[Callandiva]";  
		mes "His main abilities are magical.";  
		mes "The monster is called Strouf!";  
		mes "Now, it's time to fight with a real magician!";  
		next;
		mes "[Callandiva]";  
		mes "Try avoiding the Mermans and hunt 10 Strouf, kill them.";  
		para_suv01 = 35;  
		changequest 7157,7158;  
		close;  
	}  
	  
	mes "[Callandiva]";  
	mes "Oh are you tired?";  
	mes "Mermans are not easy opponents.";  
	mes "I will help you recover so cheer up.";  
	next;  
	switch(select("Get healed:Quest Management:Continue hunting")) {  
		case 1: callsub S_HealPlayer; break;  
		case 2: callsub S_QuestManagement; break;  
		case 3: break;  
	}  
	return;  
  
// Strouf hunting phase  
S_StroufHunt:  
	if (checkquest(7158,HUNTING) == 2) {  
		mes "[Callandiva]";  
		mes "Did you kill all the Strouf already?";  
		mes "I wasn't counting that you'd make it.";  
		mes "I have eyes on the top of my head haha.";  
		mes "Let me reward you.";  
		mes "Base Experience: "+ F_Insertcomma(.base_exp[1]) +".";  
		mes "Job Experience: "+ F_Insertcomma(.job_exp[1]) +".";  
		mes "Item: "+ F_Insertcomma(.item_amount[1]) +"x "+ mesitemicon(.item_reward[1]) +".";  
		next;  
		// Claim reward  
		getexp .base_exp[1], .job_exp[1];  
		getitem .item_reward[1], .item_amount[1];
		mes "[Callandiva]";  
		mes "Of course I'm just kidding.";  
		mes "Don't look at me like that~ it was a joke~!";  
		mes "Now you're feeling more at ease about this.";  
		next;  
		mes "[Callandiva]";  
		mes "Go back to the headquarters and report it.~";  
		mes "You will receive the last uniform from the Eden Group headquarters.";    
		mes "[Callandiva]";  
		mes "This training mission is made for beginners.";  
		mes "So it might be useless to you or not.";  
		next;  
		mes "[Callandiva]";  
		mes "Anyway you did great job!";  
		para_suv01 = 36;  
		changequest 7158,7159;  
		close;  
	}  
	  
	mes "[Callandiva]";  
	mes "Oh are you tired?";  
	mes "Strouf are not easy opponents.";  
	mes "I can help you recover so cheer up.";  
	next;  
	switch(select("Get healed:Quest Management:Continue hunting")) {  
		case 1: callsub S_HealPlayer; break;  
		case 2: callsub S_QuestManagement; break;  
		case 3: break;  
	}  
	return;  
  
// Quest completion state  
S_QuestComplete:  
	mes "[Callandiva]";  
	mes "I won't give help to you anymore.";  
	mes "Go back to our headquarters and report about this training mission.";  
	next;  
	switch(select("Quest Management:Just chatting:Leave")) {  
		case 1: callsub S_QuestManagement; break;  
		case 2:  
			mes "[Callandiva]";  
			mes "Keep up the excellent work with Eden Group!";  
			break;  
		case 3: break;  
	}  
	close;  
  
// Default dialog  
S_DefaultDialog:  
	mes "[Callandiva]";  
	mes "Mysteriously although we're under the sea you can still breathe here.";  
	mes "Do you know why?";  
	next;  
	mes "[Callandiva]";  
	mes "Let's see due to the moisture my skin is so soft.";  
	mes "My fingers and toes are not attached to each other amazing.";  
	next;  
	mes "[Callandiva]";  
	mes "I was really shocked and scared when the Eden Group dispatched me here.";  
	mes "Now I love this environment so much.";  
	mes "It's really calm...";  
	next;  
	switch(select("Quest Management:Just chatting:Leave")) {  
		case 1: callsub S_QuestManagement; break;  
		case 2:  
			mes "[Callandiva]";  
			mes "Keep up the excellent work with Eden Group!";  
			break;  
		case 3: break;  
	}  
	close;  
  
// Helper function for healing  
S_HealPlayer:  
	mes "-Callandiva's ocean magic restores your vitality.-";  
	npcskill "AL_HEAL",11,99,60;  
	percentheal 100,100;  
	return;  
  
// Quest Management Functions  
S_QuestManagement:  
	mes "[Callandiva]";  
	mes "What do you need help with regarding your ocean city training?";  
	next;  
	switch(select("View Current Quest:Abandon Quest:Quest Status:Cancel")) {  
		case 1: callsub S_ViewCurrentQuest; break;  
		case 2: callsub S_AbandonQuest; break;  
		case 3: callsub S_QuestStatus; break;  
		case 4: mes "Come back if you need help navigating the depths!"; break;  
	}  
	return;  
  
S_ViewCurrentQuest:  
	mes "[Callandiva]";  
	mes "Your current ocean city training progress:";  
	mes " ";  
	  
	switch(para_suv01) {  
		case 33:  
			mes "^0000FFOcean City Introduction^000000";  
			mes "  Status: Accept the ocean city training mission";  
			break;  
		case 34:  
			mes "^00FF00Merman Hunt^000000 - In Progress";  
			mes "  Status: Hunt 15 Mermans in the ocean city";  
			break;  
		case 35:  
			mes "^00FF00Strouf Hunt^000000 - In Progress";  
			mes "  Status: Hunt 10 Stroufs (Final step!)";  
			break;  
		case 36:  
			mes "^0000FFOcean City Training Complete^000000";  
			mes "  Status: Return to Boya at Eden Group HQ";  
			break;  
		default:  
			mes "^FF0000No active ocean city training quest.^000000";  
			mes "^FF0000You might need to talk to Instructor Boya first.^000000";  
			break;  
	}  
	return;  
  
S_AbandonQuest:  
	if (para_suv01 < 33 || para_suv01 > 35) {  
		mes "[Callandiva]";  
		mes "You don't have any active ocean city training to abandon.";  
		return;  
	}  
	  
	mes "[Callandiva]";  
	mes "^FF0000Warning:^000000 Abandoning will only clear your current hunting progress!";  
	mes "Are you sure you want to give up? The ocean needs to be secured!";  
	next;  
	  
	if (select("Yes, abandon current hunt:No, continue training") == 2) {  
		mes "[Callandiva]";  
		mes "Good choice! The sea creatures won't defeat themselves!";  
		return;  
	}  
	  
	// Only erase current hunting quest  
	switch(para_suv01) {  
		case 34:  
			if (checkquest(7157) >= 0) erasequest 7157;  
			para_suv01 = 33;  // Back to introduction  
			break;  
		case 35:  
			if (checkquest(7158) >= 0) erasequest 7158;  
			para_suv01 = 34;  // Back to Merman hunt  
			break;  
	}  
	  
	mes "[Callandiva]";  
	mes "Current hunt abandoned. You can restart this step anytime.";  
	return;  
  
S_QuestStatus:  
	mes "[Callandiva]";  
	mes "Let me check your hunting progress in the ocean depths...";  
	mes " ";  
	  
	switch(para_suv01) {  
		case 34:  
			.@progress = checkquest(7157,HUNTING);  
			if (.@progress == 2) {  
				mes "^00FF00Merman Hunt: COMPLETE!^000000";  
				mes "Come talk to me to proceed to the next step.";  
			} else {  
				mes "^FFFFFFMerman Hunt: In Progress^000000";  
				mes "Keep hunting those warrior fish in the ocean city.";  
			}  
			break;  
		case 35:  
			.@progress = checkquest(7158,HUNTING);  
			if (.@progress == 2) {  
				mes "^00FF00Strouf Hunt: COMPLETE!^000000";  
				mes "Come talk to me to finish your ocean city training!";  
			} else {  
				mes "^FFFFFFStrouf Hunt: In Progress^000000";  
				mes "Keep hunting those magical sea creatures.";  
			}  
			break;  
		default:  
			mes "^FF0000No active hunting quests to check.^000000";  
			break;  
	}  
	return;  
  
OnInit:  
	// Reward arrays for ocean city training quests (indices 0-1)  
	setarray .base_exp[0], 5400, 6000;    
	setarray .job_exp[0], 5400, 6000;  
	setarray .item_reward[0], 25223, 25223;    
	setarray .item_amount[0], 1, 1;  
	  
	setunitdata(getnpcid(0), UNPC_GROUP_ID, 6);  
	end;  
}
